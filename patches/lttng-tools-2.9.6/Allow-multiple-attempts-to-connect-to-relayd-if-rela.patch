From 4351f1ee8d2ff64598c8a5783df343c095643edb Mon Sep 17 00:00:00 2001
Message-Id: <4351f1ee8d2ff64598c8a5783df343c095643edb.1467102036.git.anders.wallin@windriver.com>
From: Anders Wallin <anders.wallin@windriver.com>
Date: Tue, 28 Jun 2016 10:20:32 +0200
Subject: [PATCH 1/1] Allow multiple attempts to connect to relayd, if relayd
 version is OK

Signed-off-by: Anders Wallin <anders.wallin@windriver.com>
---
 src/bin/lttng-sessiond/cmd.c | 3 ++-
 1 file changed, 2 insertions(+), 1 deletion(-)

diff --git a/src/bin/lttng-sessiond/cmd.c b/src/bin/lttng-sessiond/cmd.c
index cc26e6d..85abe96 100644
--- a/src/bin/lttng-sessiond/cmd.c
+++ b/src/bin/lttng-sessiond/cmd.c
@@ -939,12 +939,13 @@ close_sock:
 	free(rsock);
 
 error:
-	if (ret != LTTNG_OK) {
+	if (ret == LTTNG_ERR_RELAYD_VERSION_FAIL) {
 		/*
 		 * The consumer output for this session should not be used anymore
 		 * since the relayd connection failed thus making any tracing or/and
 		 * streaming not usable.
 		 */
+		ERR("Relayd version is NOT compatible!");
 		consumer->enabled = 0;
 	}
 	return ret;
-- 
2.9.0

